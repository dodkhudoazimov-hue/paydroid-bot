import telebot
import time

# üîë –¢–æ–∫–µ–Ω–∏ —Ö—É–¥—Ä–æ –≥—É–∑–æ—Ä
bot = telebot.TeleBot("8238563485:AAHNLTZodPeXcl7YfjZqIqY6BpcPuP3QGXs")

# üìú –ö–∞–ª–∏–º–∞“≥–æ–∏ –º–∞–Ω—ä—à—É–¥–∞
kalimahoi_mamnue = ["–¥–∞—à–Ω–æ–º", "“≥–∞–π–≤–æ–Ω", "–±–µ—Ñ–∞—Ä–æ—Å–∞—Ç", "–¥–µ–≤–æ–Ω–∞"]

# üì¶ “≤–∏—Å–æ–±–∫—É–Ω–∏–∏ “≥—É—à–¥–æ—Ä“≥–æ –≤–∞ –ø–∞—ë–º“≥–æ
hushdor = {}
last_message_time = {}

# üìã “ö–æ–∏–¥–∞“≥–æ–∏ –≥—É—Ä”Ø“≥
rules_text = """
üìú “ö–û–ò–î–ê“≤–û–ò –ì–£–†”Æ“≤:
1Ô∏è‚É£ –î–∞—à–Ω–æ–º –≤–∞ –±–µ“≥—É—Ä–º–∞—Ç”£ –º–∞–Ω—ä –∞—Å—Ç ‚ùå  
2Ô∏è‚É£ –°–ø–∞–º, —Ä–µ–∫–ª–∞–º–∞ –≤–∞ –ª–∏–Ω–∫“≥–æ–∏ –±–µ—Ä—É–Ω–∞ –º–∞–Ω—ä –∞—Å—Ç üìµ  
3Ô∏è‚É£ –ë–∞ “≥–∞–º–¥–∏–≥–∞—Ä —ç“≥—Ç–∏—Ä–æ–º –≥—É–∑–æ—Ä–µ–¥ üôè  
4Ô∏è‚É£ 3 –º–∞—Ä–æ—Ç–∏–±–∞ “õ–æ–∏–¥–∞–≤–∞–π—Ä–æ–Ω–∫—É–Ω”£ = –ë–ê–ù üö´
"""

# üëã –•—É—à–æ–º–∞–¥–≥”Ø”£
@bot.message_handler(content_types=['new_chat_members'])
def welcome(message):
    for user in message.new_chat_members:
        bot.send_message(message.chat.id, f"üéâ –°–∞–ª–æ–º @{user.username or user.first_name}! –•—É—à –æ–º–∞–¥”£ –±–∞ –≥—É—Ä”Ø“≥!")

# üß† –§—É–Ω–∫—Å–∏—è –±–∞—Ä–æ–∏ –¥–æ–Ω–∏—Å—Ç–∞–Ω–∏ –∞–¥–º–∏–Ω
def is_admin(chat_id, user_id):
    try:
        member = bot.get_chat_member(chat_id, user_id)
        return member.status in ["administrator", "creator"]
    except:
        return False

# üí¨ –§–∏–ª—Ç—Ä –≤–∞ “∑–∞–≤–æ–±
@bot.message_handler(func=lambda message: True, content_types=['text'])
def main(message):
    chat_id = message.chat.id
    user_id = message.from_user.id
    username = message.from_user.username or message.from_user.first_name
    text = message.text.lower()

    # üß† –ú—É“≥–æ—Ñ–∏–∑–∞—Ç–∏ —Å–ø–∞–º
    now = time.time()
    if user_id in last_message_time:
        diff = now - last_message_time[user_id]
        if diff < 1.2:
            bot.delete_message(chat_id, message.message_id)
            bot.send_message(chat_id, f"üö® @{username}, –∏–ª—Ç–∏–º–æ—Å —Å–ø–∞–º –Ω–∞–∫—É–Ω!")
            return
    last_message_time[user_id] = now

    # üö´ –ö–∞–ª–∏–º–∞“≥–æ–∏ –º–∞–Ω—ä—à—É–¥–∞
    for kal in kalimahoi_mamnue:
        if kal in text:
            bot.delete_message(chat_id, message.message_id)
            hushdor[user_id] = hushdor.get(user_id, 0) + 1

            if hushdor[user_id] == 1:
                bot.send_message(chat_id, f"‚ö†Ô∏è @{username}, –∏–Ω –∫–∞–ª–∏–º–∞ –º–∞–Ω—ä –∞—Å—Ç! (“≥—É—à–¥–æ—Ä–∏ {hushdor[user_id]})")
            elif hushdor[user_id] == 2:
                bot.send_message(chat_id, f"üö´ @{username}, –±–æ–∑ —è–∫ –±–æ—Ä —Ç–∞–∫—Ä–æ—Ä —à—É–¥. –≠“≥—Ç–∏—ë—Ç –∫—É–Ω!")
            elif hushdor[user_id] >= 3:
                bot.send_message(chat_id, f"‚õî @{username} –±–∞–Ω —à—É–¥ –±–∞—Ä–æ–∏ –≤–∞–π—Ä–æ–Ω –∫–∞—Ä–¥–∞–Ω–∏ “õ–æ–∏–¥–∞“≥–æ!")
                try:
                    bot.ban_chat_member(chat_id, user_id)
                except Exception:
                    bot.send_message(chat_id, "–ú–∞–Ω “≥—É“õ—É“õ–∏ –±–∞–Ω –Ω–∞–¥–æ—Ä–∞–º üòÖ")
            return

    # üí¨ “∂–∞–≤–æ–±“≥–æ–∏ –¥”Ø—Å—Ç–æ–Ω–∞
    if "—Å–∞–ª–æ–º" in text:
        bot.reply_to(message, "–°–∞–ª–æ–º! üòä –•—É—à –æ–º–∞–¥”£!")
    elif "—á”£ —Ö–∞–±–∞—Ä" in text:
        bot.reply_to(message, "“≤–∞–º–∞–∞—à —Ö—É–±, —Ç—É —á”£ —Ö–∞–±–∞—Ä?")
    elif "–Ω–æ–º–∏ —Ç—É" in text:
        bot.reply_to(message, "–ú–∞–Ω –ú–∞—Ä–∑–ë–æ—Ç ü§ñ “≥–∞—Å—Ç–∞–º ‚Äî –º—É“≥–æ—Ñ–∏–∑–∏ –≥—É—Ä”Ø“≥!")
    elif "—á”£ –º–µ–∫—É–Ω”£" in text:
        bot.reply_to(message, "–ì—É—Ä”Ø“≥—Ä–æ —Ç–æ–∑–∞ –Ω–∏–≥–æ“≥ –º–µ–¥–æ—Ä–∞–º –≤–∞ –±–æ –æ–¥–∞–º–æ–Ω —Å”Ø“≥–±–∞—Ç –º–µ–∫—É–Ω–∞–º üòé")

# üßæ /rules —Ñ–∞—Ä–º–æ–Ω
@bot.message_handler(commands=['rules'])
def rules(message):
    bot.reply_to(message, rules_text)

# üß† /warnlist —Ñ–∞—Ä–º–æ–Ω (—Ç–∞–Ω“≥–æ –∞–¥–º–∏–Ω)
@bot.message_handler(commands=['warnlist'])
def warnlist(message):
    if not is_admin(message.chat.id, message.from_user.id):
        bot.reply_to(message, "üö´ –¢–∞–Ω“≥–æ –∞–¥–º–∏–Ω“≥–æ –º–µ—Ç–∞–≤–æ–Ω–∞–Ω–¥ –∏–Ω —Ñ–∞—Ä–º–æ–Ω—Ä–æ –∏—Å—Ç–∏—Ñ–æ–¥–∞ –±–∞—Ä–∞–Ω–¥!")
        return

    if not hushdor:
        bot.reply_to(message, "‚úÖ “≤–æ–ª–æ –∫–∞—Å–µ “≥—É—à–¥–æ—Ä –Ω–∞–≥–∏—Ä–∏—Ñ—Ç–∞–∞—Å—Ç.")
        return

    msg = "‚ö†Ô∏è –†”Ø–π—Ö–∞—Ç–∏ “≥—É—à–¥–æ—Ä“≥–æ:\n"
    for uid, warn_count in hushdor.items():
        try:
            user = bot.get_chat_member(message.chat.id, uid).user
            name = user.username or user.first_name
            msg += f"‚Ä¢ {name} ‚Äî {warn_count} “≥—É—à–¥–æ—Ä\n"
        except:
            pass
    bot.reply_to(message, msg)

# üö™ /unban —Ñ–∞—Ä–º–æ–Ω (—Ç–∞–Ω“≥–æ –∞–¥–º–∏–Ω)
@bot.message_handler(commands=['unban'])
def unban_user(message):
    if not is_admin(message.chat.id, message.from_user.id):
        bot.reply_to(message, "üö´ –¢–∞–Ω“≥–æ –∞–¥–º–∏–Ω –º–µ—Ç–∞–≤–æ–Ω–∞–¥ –±–∞–Ω—Ä–æ –±–∞—Ä–¥–æ—Ä–∞–¥!")
        return

    try:
        parts = message.text.split()
        if len(parts) < 2:
            bot.reply_to(message, "–ò—Å—Ç–∏—Ñ–æ–¥–∞: `/unban <user_id>`", parse_mode="Markdown")
            return

        user_id = int(parts[1])
        bot.unban_chat_member(message.chat.id, user_id)
        bot.reply_to(message, f"‚úÖ –ö–æ—Ä–±–∞—Ä –±–æ ID `{user_id}` –∫—É—à–æ–¥–∞ —à—É–¥.", parse_mode="Markdown")
    except Exception as e:
        bot.reply_to(message, f"–•–∞—Ç–æ –¥–∞—Ä —Ñ–∞—Ä–º–æ–Ω: {e}")

# ‚ÑπÔ∏è /info —Ñ–∞—Ä–º–æ–Ω
@bot.message_handler(commands=['info'])
def info(message):
    bot.reply_to(message, "ü§ñ –ú–∞–Ω –ú–∞—Ä–∑–ë–æ—Ç “≥–∞—Å—Ç–∞–º!\n–ú—É“≥–æ—Ñ–∏–∑–∏ –≥—É—Ä”Ø“≥ –≤–∞ —Å”Ø“≥–±–∞—Ç–∫—É–Ω–∞–Ω–¥–∞–∏ –¥”Ø—Å—Ç–æ–Ω–∞ üòÑ")

# ‚ñ∂Ô∏è –û“ì–æ–∑–∏ –±–æ—Ç
print("ü§ñ –ú–∞—Ä–∑–ë–æ—Ç –±–æ —Ñ–∞—Ä–º–æ–Ω“≥–æ —Ñ–∞—ä–æ–ª —à—É–¥...")
bot.infinity_polling()
