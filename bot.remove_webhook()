import telebot
from telebot import types
import time

# üîë –¢–æ–∫–µ–Ω –≤–∞ –º–∞—ä–ª—É–º–æ—Ç–∏ –∞—Å–æ—Å”£
bot = telebot.TeleBot("–¢8238563485:AAHNLTZodPeXcl7YfjZqIqY6BpcPuP3QGXs")
ADMIN_ID = 8377215874
CHANNEL_USERNAME = "@–ù–æ–º–∏_–ö–∞–Ω–∞–ª–∏_–®—É–º–æ"  # –º–∏—Å–æ–ª: @MarzChannel

# üìã –ú–∞—ä–ª—É–º–æ—Ç“≥–æ
kalimahoi_mamnue = ["–¥–∞“≥—à–∞—Ç", "“≥–∞–π–≤–æ–Ω", "–±–µ—Ñ–∞—Ä–æ—Å–∞—Ç", "–¥–µ–≤–æ–Ω–∞"]
hushdor = {}
last_message_time = {}

rules_text = """
üìú “ö–û–ò–î–ê“≤–û–ò –ì–£–†”Æ“≤:
1Ô∏è‚É£ –î–∞—à–Ω–æ–º –≤–∞ –±–µ“≥—É—Ä–º–∞—Ç”£ –º–∞–Ω—ä –∞—Å—Ç ‚ùå  
2Ô∏è‚É£ –°–ø–∞–º –≤–∞ —Ä–µ–∫–ª–∞–º–∞ –º–∞–Ω—ä –∞—Å—Ç üìµ  
3Ô∏è‚É£ –ë–∞ “≥–∞–º–¥–∏–≥–∞—Ä —ç“≥—Ç–∏—Ä–æ–º –≥—É–∑–æ—Ä–µ–¥ üôè  
4Ô∏è‚É£ –ë–∞—Ä–æ–∏ –Ω–∞–≤–∏—à—Ç–∞–Ω –∞–≤–≤–∞–ª —É–∑–≤–∏ –∫–∞–Ω–∞–ª —à–∞–≤–µ–¥!
"""

# üëã –•—É—à–æ–º–∞–¥–≥”Ø”£ –±–∞ –∞—ä–∑–æ“≥–æ–∏ –Ω–∞–≤
@bot.message_handler(content_types=['new_chat_members'])
def welcome(message):
    for user in message.new_chat_members:
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton("‚ñ∂ –ë–∞ –∫–∞–Ω–∞–ª –≥—É–∑–∞—à—Ç–∞–Ω", url=f"https://t.me/{CHANNEL_USERNAME.replace('@','')}"))
        bot.send_message(
            message.chat.id,
            f"üéâ –°–∞–ª–æ–º @{user.username or user.first_name}!\n–ë–∞—Ä–æ–∏ –∏—à—Ç–∏—Ä–æ–∫ –¥–∞—Ä —Å”Ø“≥–±–∞—Ç –∞–≤–≤–∞–ª –±–∞ –∫–∞–Ω–∞–ª–∏ –º–æ –æ–±—É–Ω–∞ —à–∞–≤–µ–¥.",
            reply_markup=markup
        )

# üß† –°–∞–Ω“∑–∏—à–∏ –∞–¥–º–∏–Ω
def is_admin(chat_id, user_id):
    if user_id == ADMIN_ID:
        return True
    try:
        member = bot.get_chat_member(chat_id, user_id)
        return member.status in ["administrator", "creator"]
    except:
        return False

# üîç –°–∞–Ω“∑–∏—à–∏ —É–∑–≤–∏—è—Ç –¥–∞—Ä –∫–∞–Ω–∞–ª
def is_subscribed(user_id):
    try:
        member = bot.get_chat_member(CHANNEL_USERNAME, user_id)
        return member.status in ["member", "administrator", "creator"]
    except:
        return False

# ‚ñ∂Ô∏è –§–∞—Ä–º–æ–Ω–∏ /start –±–æ —Ç—É–≥–º–∞“≥–æ
@bot.message_handler(commands=['start'])
def start(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    btn1 = types.KeyboardButton("üßæ “ö–æ–∏–¥–∞“≥–æ")
    btn2 = types.KeyboardButton("üì° –ü–∞–π–≤–∞—Å—Ç –∫–∞—Ä–¥–∞–Ω–∏ –∫–∞–Ω–∞–ª")
    btn3 = types.KeyboardButton("‚ÑπÔ∏è –î–∞—Ä –±–æ—Ä–∞–∏ –±–æ—Ç")
    markup.add(btn1, btn2, btn3)

    if message.from_user.id == ADMIN_ID:
        btn4 = types.KeyboardButton("üëÆ –ü—Ä–æ—Ñ–∏–ª–∏ –∞–¥–º–∏–Ω")
        markup.add(btn4)

    bot.send_message(
        message.chat.id,
        f"–°–∞–ª–æ–º {message.from_user.first_name}! ü§ñ\n–ú–∞–Ω –ú–∞—Ä–∑–ë–æ—Ç “≥–∞—Å—Ç–∞–º ‚Äî –º—É“≥–æ—Ñ–∏–∑–∏ –≥—É—Ä”Ø“≥ –≤–∞ —ë–≤–∞—Ä–∏ —Ç—É.",
        reply_markup=markup
    )

# üì± –ò–¥–æ—Ä–∞–∫—É–Ω–∏–∏ —Ç—É–≥–º–∞“≥–æ
@bot.message_handler(func=lambda m: True)
def handle_buttons(message):
    text = message.text.lower()
    chat_id = message.chat.id
    user_id = message.from_user.id
    username = message.from_user.username or message.from_user.first_name

    # üß≠ –î–∞—Ä —á–∞—Ç–∏ —à–∞—Ö—Å”£
    if message.chat.type == "private":
        if "“õ–æ–∏–¥–∞" in text:
            bot.send_message(chat_id, rules_text)
        elif "–¥–∞—Ä –±–æ—Ä–∞–∏" in text:
            bot.send_message(chat_id, "ü§ñ –ú–∞–Ω –ú–∞—Ä–∑–ë–æ—Ç “≥–∞—Å—Ç–∞–º!\n–ú–∞–Ω –≥—É—Ä”Ø“≥“≥–æ—Ä–æ –º—É“≥–æ—Ñ–∏–∑–∞—Ç –º–µ–∫—É–Ω–∞–º –≤–∞ –±–æ –æ–¥–∞–º–æ–Ω —Å”Ø“≥–±–∞—Ç –º–µ–∫—É–Ω–∞–º.")
        elif "–ø–∞–π–≤–∞—Å—Ç" in text:
            bot.send_message(chat_id, "üì° –ë–∞—Ä–æ–∏ –ø–∞–π–≤–∞—Å—Ç –∫–∞—Ä–¥–∞–Ω–∏ –∫–∞–Ω–∞–ª:\n1Ô∏è‚É£ –ö–∞–Ω–∞–ª–∏ —Ö—É–¥—Ä–æ –∫—É—à–æ\n2Ô∏è‚É£ –ë–æ—Ç—Ä–æ –∞–¥–º–∏–Ω –≥—É–∑–æ—Ä\n3Ô∏è‚É£ –ë–∞ –º–∞–Ω –Ω–æ–º–∏ –∫–∞–Ω–∞–ª–∏ —Ö—É–¥—Ä–æ –±–∏—Ñ–∏—Ä–∏—Å—Ç (@examplechannel)\n–ë–∞—ä–¥ –º–∞–Ω –æ–Ω—Ä–æ –±–∞—Ä–æ–∏ —Ñ–æ—Ä—Å-—Å–∞–±—Å–∫—Ä–∞–π–± –∏—Å—Ç–∏—Ñ–æ–¥–∞ –º–µ–±–∞—Ä–∞–º.")
        elif "–∞–¥–º–∏–Ω" in text and user_id == ADMIN_ID:
            markup = types.InlineKeyboardMarkup()
            markup.add(types.InlineKeyboardButton("üë§ –ë–∞ –ø—Ä–æ—Ñ–∏–ª–∏ –∞–¥–º–∏–Ω –≥—É–∑–∞—à—Ç–∞–Ω", url=f"https://t.me/{username}"))
            bot.send_message(chat_id, f"üëÆ –ü—Ä–æ—Ñ–∏–ª–∏ –∞–¥–º–∏–Ω:\nID: {ADMIN_ID}\n–ù–æ–º: {username}", reply_markup=markup)
        else:
            bot.send_message(chat_id, "–ò–Ω —Ç—É–≥–º–∞ –∞–º–∞–ª –Ω–∞–¥–æ—Ä–∞–¥ üòÖ")
        return

    # üí¨ –î–∞—Ä –≥—É—Ä”Ø“≥ ‚Äî —Ñ–∏–ª—Ç—Ä“≥–æ
    if not is_subscribed(user_id):
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton("‚ñ∂ –ë–∞ –∫–∞–Ω–∞–ª –≥—É–∑–∞—à—Ç–∞–Ω", url=f"https://t.me/{CHANNEL_USERNAME.replace('@','')}"))
        bot.reply_to(message, "‚õî –ë–∞—Ä–æ–∏ –Ω–∞–≤–∏—à—Ç–∞–Ω –∞–≤–≤–∞–ª –±–∞ –∫–∞–Ω–∞–ª–∏ –º–æ –æ–±—É–Ω–∞ —à–∞–≤–µ–¥!", reply_markup=markup)
        try:
            bot.delete_message(chat_id, message.message_id)
        except:
            pass
        return

    # üß† –ú—É“≥–æ—Ñ–∏–∑–∞—Ç –∞–∑ —Å–ø–∞–º
    now = time.time()
    if user_id in last_message_time and now - last_message_time[user_id] < 1.5:
        bot.delete_message(chat_id, message.message_id)
        bot.send_message(chat_id, f"üö® @{username}, –∏–ª—Ç–∏–º–æ—Å —Å–ø–∞–º –Ω–∞–∫—É–Ω!")
        return
    last_message_time[user_id] = now

    # üö´ –ö–∞–ª–∏–º–∞“≥–æ–∏ –º–∞–Ω—ä—à—É–¥–∞
    for kal in kalimahoi_mamnue:
        if kal in text:
            bot.delete_message(chat_id, message.message_id)
            hushdor[user_id] = hushdor.get(user_id, 0) + 1

            if hushdor[user_id] == 1:
                bot.send_message(chat_id, f"‚ö†Ô∏è @{username}, –∏–Ω –∫–∞–ª–∏–º–∞ –º–∞–Ω—ä –∞—Å—Ç! (“≥—É—à–¥–æ—Ä–∏ –∞–≤–≤–∞–ª)")
            elif hushdor[user_id] == 2:
                bot.send_message(chat_id, f"üö´ @{username}, –±–æ–∑ —è–∫ –±–æ—Ä —Ç–∞–∫—Ä–æ—Ä —à—É–¥!")
            elif hushdor[user_id] >= 3:
                bot.send_message(chat_id, f"‚õî @{username} –±–∞–Ω —à—É–¥ –±–∞—Ä–æ–∏ –±–µ“≥—É—Ä–º–∞—Ç”£!")
                try:
                    bot.ban_chat_member(chat_id, user_id)
                except:
                    bot.send_message(chat_id, "–ú–∞–Ω “≥—É“õ—É“õ–∏ –±–∞–Ω –Ω–∞–¥–æ—Ä–∞–º üòÖ")
            return

    # üí¨ “∂–∞–≤–æ–±“≥–æ–∏ –¥”Ø—Å—Ç–æ–Ω–∞
    if "—Å–∞–ª–æ–º" in text:
        bot.reply_to(message, "–°–∞–ª–æ–º! üòä")
    elif "—á”£ —Ö–∞–±–∞—Ä" in text:
        bot.reply_to(message, "“≤–∞–º–∞–∞—à —Ö—É–±, —Ç—É —á”£ —Ö–∞–±–∞—Ä?")
    elif "–Ω–æ–º–∏ —Ç—É" in text:
        bot.reply_to(message, "–ú–∞–Ω –ú–∞—Ä–∑–ë–æ—Ç ü§ñ “≥–∞—Å—Ç–∞–º ‚Äî –º—É“≥–æ—Ñ–∏–∑–∏ –≥—É—Ä”Ø“≥!")
    elif "—á”£ –º–µ–∫—É–Ω”£" in text:
        bot.reply_to(message, "–ì—É—Ä”Ø“≥—Ä–æ —Ç–æ–∑–∞ –Ω–∏–≥–æ“≥ –º–µ–¥–æ—Ä–∞–º –≤–∞ –±–æ –æ–¥–∞–º–æ–Ω —Å”Ø“≥–±–∞—Ç –º–µ–∫—É–Ω–∞–º üòé")

# ‚ñ∂Ô∏è –û“ì–æ–∑–∏ –±–æ—Ç
print("ü§ñ –ú–∞—Ä–∑–ë–æ—Ç –±–æ —Ç—É–≥–º–∞“≥–æ –≤–∞ —Å–∏—Å—Ç–µ–º–∞–∏ –∫–∞–Ω–∞–ª —Ñ–∞—ä–æ–ª —à—É–¥...")
bot.infinity_polling()
