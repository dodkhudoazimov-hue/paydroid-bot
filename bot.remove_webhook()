import telebot

# üëâ “∂–æ–π–∏ TOKEN-–∏ —Ö—É–¥—Ä–æ –≥—É–∑–æ—Ä
TOKEN = "8238563485:AAHNLTZodPeXcl7YfjZqIqY6BpcPuP3QGXs"
bot = telebot.TeleBot(TOKEN)

# –ú–æ–ª“≥–æ–∏ –Ω–∞–º—É–Ω–∞–≤”£
products = {
    "1": {"name": "–¢–µ–ª–µ—Ñ–æ–Ω", "price": 1200},
    "2": {"name": "–ù–∞—É—à–Ω–∏–∫", "price": 150},
    "3": {"name": "–ó–∞—Ä—è–¥–Ω–∏–∫", "price": 50},
}

# –°–∞–±–∞–¥–∏ –∫–æ—Ä–±–∞—Ä–æ–Ω
user_carts = {}

def get_cart_text(cart):
    if not cart:
        return "üõí –°–∞–±–∞–¥ —Ö–æ–ª”£ –∞—Å—Ç."
    text = "üõç –ú–æ–ª“≥–æ –¥–∞—Ä —Å–∞–±–∞–¥:\n"
    total = 0
    for item in cart:
        text += f"‚Ä¢ {item['name']} - {item['price']} —Å–æ–º–æ–Ω”£\n"
        total += item['price']
    text += f"\nüí∞ “∂–∞–º—ä: {total} —Å–æ–º–æ–Ω”£"
    return text

@bot.message_handler(commands=['start'])
def start(message):
    bot.send_message(message.chat.id,
        "–°–∞–ª–æ–º üëã\n–ò–Ω –º–∞“ì–æ–∑–∞–∏ –æ–Ω–ª–∞–π–Ω –∞—Å—Ç.\n–ë–∞—Ä–æ–∏ –¥–∏–¥–∞–Ω–∏ –º–æ–ª“≥–æ —Ñ–∞—Ä–º–æ–Ω–∏ /shop –Ω–∞–≤–∏—Å.")

@bot.message_handler(commands=['shop'])
def show_products(message):
    text = "üì¶ –ú–æ–ª“≥–æ–∏ –¥–∞—Å—Ç—Ä–∞—Å:\n"
    for pid, p in products.items():
        text += f"{pid}. {p['name']} - {p['price']} —Å–æ–º–æ–Ω”£\n"
    text += "\n–ë–∞—Ä–æ–∏ –∏–ª–æ–≤–∞ –±–∞ —Å–∞–±–∞–¥, —Ä–∞“õ–∞–º–∏ –º–æ–ª—Ä–æ –Ω–∞–≤–∏—Å."
    bot.send_message(message.chat.id, text)

@bot.message_handler(func=lambda m: m.text in products.keys())
def add_to_cart(message):
    user_id = message.chat.id
    product = products[message.text]
    user_carts.setdefault(user_id, []).append(product)
    bot.send_message(user_id, f"‚úÖ {product['name']} –±–∞ —Å–∞–±–∞–¥ –∏–ª–æ–≤–∞ —à—É–¥!\n–ë–∞—Ä–æ–∏ –¥–∏–¥–∞–Ω–∏ —Å–∞–±–∞–¥ —Ñ–∞—Ä–º–æ–Ω–∏ /cart –Ω–∞–≤–∏—Å.")

@bot.message_handler(commands=['cart'])
def view_cart(message):
    cart = user_carts.get(message.chat.id, [])
    bot.send_message(message.chat.id, get_cart_text(cart))

@bot.message_handler(commands=['buy'])
def buy(message):
    cart = user_carts.get(message.chat.id, [])
    if not cart:
        bot.send_message(message.chat.id, "üõí –°–∞–±–∞–¥ —Ö–æ–ª”£ –∞—Å—Ç!")
    else:
        total = sum([p['price'] for p in cart])
        bot.send_message(message.chat.id, f"üí∏ “∂–∞–º—ä: {total} —Å–æ–º–æ–Ω”£\n\n–ë–∞—Ä–æ–∏ —Ç–∞—Å–¥–∏“õ–∏ —Ö–∞—Ä–∏–¥ –±–æ –∞–¥–º–∏–Ω —Ç–∞–º–æ—Å –≥–∏—Ä–µ–¥.")
        user_carts[message.chat.id] = []

print("–ë–æ—Ç –∫–æ—Ä –º–µ–∫—É–Ω–∞–¥...")
bot.polling(none_stop=True)
